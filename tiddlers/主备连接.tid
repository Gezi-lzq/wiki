created: 20230330010813523
creator: Gezi
modified: 20230330012236470
modifier: Gezi
tags: 应用层维护心跳
title: 主备连接
type: text/vnd.tiddlywiki

!! 方案
# 为降低用户切换连接的感知，可以为客户端维护两条长链
# 一个用来正常收发消息，另一个用户备用(push等场景)
# 当im占用长链断开时，可以通过push 长连进行下行消息的下发
# 上行消息退化为http 的post请求即可

当正常长连接出现问题而无法收发消息时，即可利用备用长连接来进行消息的下发。在这种情况下，上行消息将被转化为 HTTP POST 请求，通过备用长连接发送给服务器。

!! 收益

# 减少对用户体验的影响
# 在长连接不可用的情况下收发消息

!! 代价

# 实现复杂，需要单独实现一套逻辑。
# 需要和 push长连 打通逻辑
# 如果app 没有占用 push长连 则要自己维护一个长连进行backup成本过高